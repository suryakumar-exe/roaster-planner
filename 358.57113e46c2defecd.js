"use strict";(self.webpackChunkroaster_planner=self.webpackChunkroaster_planner||[]).push([[358],{4358:(k,h,i)=>{i.r(h),i.d(h,{LeaveManagementComponent:()=>M});var u=i(177),o=i(4341),e=i(4438),p=i(9478),D=i(4796),f=i(7474),L=i(5794);function y(s,m){1&s&&(e.j41(0,"div",41),e.nrm(1,"i",42),e.j41(2,"strong"),e.EFF(3,"Leave will be automatically approved and reflected in your roster calendar."),e.k0s()())}function F(s,m){if(1&s){const t=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",10)(3,"div",11)(4,"h5",12),e.EFF(5,"Apply for Leave"),e.k0s()(),e.j41(6,"div",13)(7,"form",16,0),e.bIt("ngSubmit",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.createLeave())}),e.j41(9,"div",9)(10,"div",17)(11,"label",18),e.EFF(12,"Leave Type"),e.k0s(),e.j41(13,"select",19),e.mxI("ngModelChange",function(a){e.eBV(t);const n=e.XpG();return e.DH7(n.newLeave.leaveType,a)||(n.newLeave.leaveType=a),e.Njj(a)}),e.j41(14,"option",20),e.EFF(15,"Select leave type"),e.k0s(),e.j41(16,"option",21),e.EFF(17,"Annual Leave"),e.k0s(),e.j41(18,"option",22),e.EFF(19,"Sick Leave"),e.k0s(),e.j41(20,"option",23),e.EFF(21,"Personal Leave"),e.k0s(),e.j41(22,"option",24),e.EFF(23,"Maternity Leave"),e.k0s(),e.j41(24,"option",25),e.EFF(25,"Paternity Leave"),e.k0s(),e.j41(26,"option",26),e.EFF(27,"Bereavement Leave"),e.k0s(),e.j41(28,"option",27),e.EFF(29,"Other"),e.k0s()()(),e.j41(30,"div",17)(31,"label",28),e.EFF(32,"Total Days"),e.k0s(),e.j41(33,"input",29),e.mxI("ngModelChange",function(a){e.eBV(t);const n=e.XpG();return e.DH7(n.newLeave.totalDays,a)||(n.newLeave.totalDays=a),e.Njj(a)}),e.k0s()()(),e.j41(34,"div",9)(35,"div",17)(36,"label",30),e.EFF(37,"Start Date"),e.k0s(),e.j41(38,"input",31),e.mxI("ngModelChange",function(a){e.eBV(t);const n=e.XpG();return e.DH7(n.newLeave.startDate,a)||(n.newLeave.startDate=a),e.Njj(a)}),e.bIt("change",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.calculateTotalDays())}),e.k0s()(),e.j41(39,"div",17)(40,"label",32),e.EFF(41,"End Date"),e.k0s(),e.j41(42,"input",33),e.mxI("ngModelChange",function(a){e.eBV(t);const n=e.XpG();return e.DH7(n.newLeave.endDate,a)||(n.newLeave.endDate=a),e.Njj(a)}),e.bIt("change",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.calculateTotalDays())}),e.k0s()()(),e.j41(43,"div",34)(44,"label",35),e.EFF(45,"Reason"),e.k0s(),e.j41(46,"textarea",36),e.mxI("ngModelChange",function(a){e.eBV(t);const n=e.XpG();return e.DH7(n.newLeave.reason,a)||(n.newLeave.reason=a),e.Njj(a)}),e.k0s()(),e.DNE(47,y,4,0,"div",37),e.j41(48,"div",38)(49,"button",39),e.EFF(50," Submit Leave Request "),e.k0s(),e.j41(51,"button",40),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.cancelCreate())}),e.EFF(52," Cancel "),e.k0s()()()()()()()}if(2&s){const t=e.sdS(8),r=e.XpG();e.R7$(13),e.R50("ngModel",r.newLeave.leaveType),e.R7$(20),e.R50("ngModel",r.newLeave.totalDays),e.R7$(5),e.R50("ngModel",r.newLeave.startDate),e.R7$(4),e.R50("ngModel",r.newLeave.endDate),e.R7$(4),e.R50("ngModel",r.newLeave.reason),e.R7$(),e.Y8G("ngIf",r.newLeave.startDate&&r.newLeave.endDate),e.R7$(2),e.Y8G("disabled",!t.valid)}}function b(s,m){1&s&&(e.j41(0,"div",43),e.nrm(1,"i",44),e.j41(2,"h5",45),e.EFF(3,"No leave requests found"),e.k0s(),e.j41(4,"p"),e.EFF(5,"Submit your first leave request to get started!"),e.k0s()())}function w(s,m){if(1&s){const t=e.RV6();e.j41(0,"div",46)(1,"div",47)(2,"div",48)(3,"h6",49),e.EFF(4),e.k0s(),e.j41(5,"small",50),e.EFF(6),e.nI1(7,"date"),e.nI1(8,"date"),e.k0s()(),e.j41(9,"div",51)(10,"strong"),e.EFF(11),e.k0s(),e.j41(12,"div",52),e.EFF(13,"Days"),e.k0s()(),e.j41(14,"div",53)(15,"p",54),e.EFF(16),e.k0s()(),e.j41(17,"div",55)(18,"span",56),e.EFF(19,"Approved"),e.k0s(),e.j41(20,"div",57)(21,"button",58),e.bIt("click",function(){const a=e.eBV(t).$implicit,n=e.XpG();return e.Njj(n.deleteLeave(a.id))}),e.nrm(22,"i",59),e.EFF(23," Delete "),e.k0s()()()()()}if(2&s){const t=m.$implicit;e.R7$(4),e.JRh(t.leaveType),e.R7$(2),e.Lme("",e.i5U(7,5,t.startDate,"MMM dd, yyyy")," - ",e.i5U(8,8,t.endDate,"MMM dd, yyyy"),""),e.R7$(5),e.JRh(t.totalDays),e.R7$(5),e.JRh(t.reason)}}let M=(()=>{class s{constructor(t,r,a,n){this.leavesService=t,this.authService=r,this.rostersService=a,this.toastr=n,this.leaves=[],this.userLeaves=[],this.showCreateForm=!1,this.newLeave={leaveType:"",startDate:"",endDate:"",totalDays:1,reason:""}}ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.loadLeaves()}loadLeaves(){this.leavesService.getLeaves().subscribe({next:t=>{this.leaves=Array.isArray(t)?t:t.data||[],this.userLeaves=this.leaves.filter(r=>r.userId===this.currentUser?.id),console.log("Loaded leaves:",this.leaves),console.log("User leaves:",this.userLeaves)},error:t=>{console.error("Error loading leaves:",t),this.toastr.error("Failed to load leave requests")}})}calculateTotalDays(){if(this.newLeave.startDate&&this.newLeave.endDate){const t=new Date(this.newLeave.startDate),r=new Date(this.newLeave.endDate);if(r>=t){const a=r.getTime()-t.getTime(),n=Math.ceil(a/864e5)+1;this.newLeave.totalDays=n}}}createLeave(){if(!(this.newLeave.leaveType&&this.newLeave.startDate&&this.newLeave.endDate&&this.newLeave.reason))return void this.toastr.error("Please fill in all required fields");if(this.newLeave.totalDays<=0)return void this.toastr.error("Total days must be greater than 0");const t={...this.newLeave,userId:this.currentUser.id,userName:`${this.currentUser.firstName} ${this.currentUser.lastName}`,email:this.currentUser.email,role:this.currentUser.role,teamId:this.currentUser.teamId,teamName:this.currentUser.teamName,status:"Pending"};this.leavesService.createLeave(t).subscribe({next:r=>{this.toastr.success("Leave request submitted and approved successfully!"),this.loadLeaves(),this.cancelCreate(),this.updateRosterWithLeave(r.data)},error:r=>{console.error("Error creating leave request:",r),this.toastr.error("Failed to submit leave request")}})}updateRosterWithLeave(t){const r=new Date(t.startDate),a=new Date(t.endDate),n=[],l=new Date(r);for(;l<=a;)n.push(l.toISOString().split("T")[0]),l.setDate(l.getDate()+1);n.forEach(c=>{this.updateRosterForDate(c,t)})}updateRosterForDate(t,r){const a=new Date(t),n=a.getDay(),l=new Date(a);l.setDate(a.getDate()-n+(0===n?-6:1));const c=l.toISOString().split("T")[0];this.rostersService.getRosters().subscribe({next:v=>{const _=(Array.isArray(v)?v:v.data||[]).find(d=>d.userId===this.currentUser.id&&d.weekStartDate===c);if(_){const d={..._,leaveDays:[..._.leaveDays||[],t],updatedAt:(new Date).toISOString(),updatedBy:this.currentUser.id};this.rostersService.updateRoster(_.id,d).subscribe({next:()=>{console.log(`Updated roster for week ${c} with leave date ${t}`)},error:g=>{console.error("Error updating roster with leave:",g)}})}else{const d=new Date(l);d.setDate(l.getDate()+6);const g=d.toISOString().split("T")[0],E={userId:this.currentUser.id,userName:`${this.currentUser.firstName} ${this.currentUser.lastName}`,email:this.currentUser.email,role:this.currentUser.role,teamId:this.currentUser.teamId,teamName:this.currentUser.teamName,weekStartDate:c,weekEndDate:g,workFromOfficeDays:[],workFromHomeDays:[],leaveDays:[t],status:"Draft",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),createdBy:this.currentUser.id,updatedBy:this.currentUser.id};this.rostersService.createRoster(E).subscribe({next:()=>{console.log(`Created new roster for week ${c} with leave date ${t}`)},error:j=>{console.error("Error creating roster with leave:",j)}})}},error:v=>{console.error("Error getting rosters for leave update:",v)}})}deleteLeave(t){confirm("Are you sure you want to delete this leave request?")&&this.leavesService.deleteLeave(t).subscribe({next:r=>{this.toastr.success("Leave request deleted successfully"),this.loadLeaves()},error:r=>{console.error("Error deleting leave request:",r),this.toastr.error("Failed to delete leave request")}})}cancelCreate(){this.showCreateForm=!1,this.newLeave={leaveType:"",startDate:"",endDate:"",totalDays:1,reason:""}}static{this.\u0275fac=function(r){return new(r||s)(e.rXU(p.e),e.rXU(D.u),e.rXU(f.w),e.rXU(L.tw))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-leave-management"]],standalone:!0,features:[e.aNF],decls:22,vars:3,consts:[["leaveForm","ngForm"],[1,"container-fluid"],[1,"row","mb-4"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"text-muted","mb-0"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],["class","row mb-4",4,"ngIf"],[1,"row"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],[1,"card-body"],["class","text-center text-muted py-5",4,"ngIf"],["class","leave-item border rounded p-3 mb-3",4,"ngFor","ngForOf"],[3,"ngSubmit"],[1,"col-md-6","mb-3"],["for","leaveType",1,"form-label"],["id","leaveType","name","leaveType","required","",1,"form-select",3,"ngModelChange","ngModel"],["value",""],["value","Annual"],["value","Sick"],["value","Personal"],["value","Maternity"],["value","Paternity"],["value","Bereavement"],["value","Other"],["for","totalDays",1,"form-label"],["type","number","id","totalDays","name","totalDays","min","0.5","step","0.5","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","startDate",1,"form-label"],["type","date","id","startDate","name","startDate","required","",1,"form-control",3,"ngModelChange","change","ngModel"],["for","endDate",1,"form-label"],["type","date","id","endDate","name","endDate","required","",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"mb-3"],["for","reason",1,"form-label"],["id","reason","name","reason","rows","3","placeholder","Please provide a reason for your leave request","required","",1,"form-control",3,"ngModelChange","ngModel"],["class","alert alert-info",4,"ngIf"],[1,"d-flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"alert","alert-info"],[1,"bi","bi-info-circle","me-2"],[1,"text-center","text-muted","py-5"],[1,"bi","bi-calendar-event","fs-1"],[1,"mt-3"],[1,"leave-item","border","rounded","p-3","mb-3"],[1,"row","align-items-center"],[1,"col-md-3"],[1,"mb-1"],[1,"text-muted"],[1,"col-md-2"],[1,"small","text-muted"],[1,"col-md-4"],[1,"mb-1","text-truncate"],[1,"col-md-3","text-end"],[1,"badge","bg-success"],[1,"mt-2"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"]],template:function(r,a){1&r&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h2"),e.EFF(6,"Leave Management"),e.k0s(),e.j41(7,"p",5),e.EFF(8,"Apply for leave and manage your leave requests"),e.k0s()(),e.j41(9,"button",6),e.bIt("click",function(){return a.showCreateForm=!0}),e.nrm(10,"i",7),e.EFF(11,"Apply for Leave "),e.k0s()()()(),e.DNE(12,F,53,7,"div",8),e.j41(13,"div",9)(14,"div",3)(15,"div",10)(16,"div",11)(17,"h5",12),e.EFF(18,"My Leave Requests"),e.k0s()(),e.j41(19,"div",13),e.DNE(20,b,6,0,"div",14)(21,w,24,11,"div",15),e.k0s()()()()()),2&r&&(e.R7$(12),e.Y8G("ngIf",a.showCreateForm),e.R7$(8),e.Y8G("ngIf",0===a.userLeaves.length),e.R7$(),e.Y8G("ngForOf",a.userLeaves))},dependencies:[u.MD,u.Sq,u.bT,u.vh,o.YN,o.qT,o.xH,o.y7,o.me,o.Q0,o.wz,o.BC,o.cb,o.YS,o.VZ,o.vS,o.cV],encapsulation:2})}}return s})()}}]);