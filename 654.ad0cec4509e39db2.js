"use strict";(self.webpackChunkroaster_planner=self.webpackChunkroaster_planner||[]).push([[654],{4654:(E,m,i)=>{i.r(m),i.d(m,{UserManagementComponent:()=>j});var d=i(177),o=i(4341),e=i(4438),c=i(5602),_=i(5092),g=i(5794),u=i(4796);function p(a,l){if(1&a&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&a){const t=l.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function h(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"div",10)(3,"div",11)(4,"h5",12),e.EFF(5,"Add New User"),e.k0s()(),e.j41(6,"div",13)(7,"form",18,0),e.bIt("ngSubmit",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.createUser())}),e.j41(9,"div",9)(10,"div",19)(11,"label",20),e.EFF(12,"First Name"),e.k0s(),e.j41(13,"input",21),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.newUser.firstName,s)||(r.newUser.firstName=s),e.Njj(s)}),e.k0s()(),e.j41(14,"div",19)(15,"label",22),e.EFF(16,"Last Name"),e.k0s(),e.j41(17,"input",23),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.newUser.lastName,s)||(r.newUser.lastName=s),e.Njj(s)}),e.k0s()()(),e.j41(18,"div",9)(19,"div",19)(20,"label",24),e.EFF(21,"Email"),e.k0s(),e.j41(22,"input",25),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.newUser.email,s)||(r.newUser.email=s),e.Njj(s)}),e.k0s()(),e.j41(23,"div",19)(24,"label",26),e.EFF(25,"Employee ID"),e.k0s(),e.j41(26,"input",27),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.newUser.employeeId,s)||(r.newUser.employeeId=s),e.Njj(s)}),e.k0s()()(),e.j41(27,"div",9)(28,"div",19)(29,"label",28),e.EFF(30,"Password"),e.k0s(),e.j41(31,"input",29),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.newUser.password,s)||(r.newUser.password=s),e.Njj(s)}),e.k0s()(),e.j41(32,"div",19)(33,"label",30),e.EFF(34,"Team"),e.k0s(),e.j41(35,"select",31),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.newUser.teamId,s)||(r.newUser.teamId=s),e.Njj(s)}),e.j41(36,"option",32),e.EFF(37,"Select team"),e.k0s(),e.DNE(38,p,2,2,"option",33),e.k0s()()(),e.j41(39,"div",34)(40,"label",35),e.EFF(41,"Role"),e.k0s(),e.j41(42,"select",36),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.newUser.role,s)||(r.newUser.role=s),e.Njj(s)}),e.j41(43,"option",32),e.EFF(44,"Select Role"),e.k0s(),e.j41(45,"option",37),e.EFF(46,"Admin"),e.k0s(),e.j41(47,"option",38),e.EFF(48,"Team Lead"),e.k0s(),e.j41(49,"option",39),e.EFF(50,"Employee"),e.k0s()()(),e.j41(51,"div",40)(52,"button",41),e.EFF(53," Create User "),e.k0s(),e.j41(54,"button",42),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.cancelCreate())}),e.EFF(55," Cancel "),e.k0s()()()()()()()}if(2&a){const t=e.sdS(8),n=e.XpG();e.R7$(13),e.R50("ngModel",n.newUser.firstName),e.R7$(4),e.R50("ngModel",n.newUser.lastName),e.R7$(5),e.R50("ngModel",n.newUser.email),e.R7$(4),e.R50("ngModel",n.newUser.employeeId),e.R7$(5),e.R50("ngModel",n.newUser.password),e.R7$(4),e.R50("ngModel",n.newUser.teamId),e.R7$(3),e.Y8G("ngForOf",n.teams),e.R7$(4),e.R50("ngModel",n.newUser.role),e.R7$(10),e.Y8G("disabled",!t.valid)}}function f(a,l){if(1&a&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&a){const t=l.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function U(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"div",10)(3,"div",11)(4,"h5",12),e.EFF(5,"Edit User"),e.k0s()(),e.j41(6,"div",13)(7,"form",18,1),e.bIt("ngSubmit",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.updateUser())}),e.j41(9,"div",9)(10,"div",19)(11,"label",44),e.EFF(12,"First Name"),e.k0s(),e.j41(13,"input",45),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.editUserData.firstName,s)||(r.editUserData.firstName=s),e.Njj(s)}),e.k0s()(),e.j41(14,"div",19)(15,"label",46),e.EFF(16,"Last Name"),e.k0s(),e.j41(17,"input",47),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.editUserData.lastName,s)||(r.editUserData.lastName=s),e.Njj(s)}),e.k0s()()(),e.j41(18,"div",9)(19,"div",19)(20,"label",48),e.EFF(21,"Email"),e.k0s(),e.j41(22,"input",49),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.editUserData.email,s)||(r.editUserData.email=s),e.Njj(s)}),e.k0s()(),e.j41(23,"div",19)(24,"label",50),e.EFF(25,"Employee ID"),e.k0s(),e.j41(26,"input",51),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.editUserData.employeeId,s)||(r.editUserData.employeeId=s),e.Njj(s)}),e.k0s()()(),e.j41(27,"div",9)(28,"div",19)(29,"label",52),e.EFF(30,"Team"),e.k0s(),e.j41(31,"select",53),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.editUserData.teamId,s)||(r.editUserData.teamId=s),e.Njj(s)}),e.j41(32,"option",32),e.EFF(33,"Select team"),e.k0s(),e.DNE(34,f,2,2,"option",33),e.k0s()(),e.j41(35,"div",19)(36,"label",54),e.EFF(37,"Role"),e.k0s(),e.j41(38,"select",55),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.editUserData.role,s)||(r.editUserData.role=s),e.Njj(s)}),e.j41(39,"option",32),e.EFF(40,"Select Role"),e.k0s(),e.j41(41,"option",37),e.EFF(42,"Admin"),e.k0s(),e.j41(43,"option",38),e.EFF(44,"Team Lead"),e.k0s(),e.j41(45,"option",39),e.EFF(46,"Employee"),e.k0s()()()(),e.j41(47,"div",40)(48,"button",41),e.EFF(49," Update User "),e.k0s(),e.j41(50,"button",42),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.cancelEdit())}),e.EFF(51," Cancel "),e.k0s()()()()()()()}if(2&a){const t=e.sdS(8),n=e.XpG();e.R7$(13),e.R50("ngModel",n.editUserData.firstName),e.R7$(4),e.R50("ngModel",n.editUserData.lastName),e.R7$(5),e.R50("ngModel",n.editUserData.email),e.R7$(4),e.R50("ngModel",n.editUserData.employeeId),e.R7$(5),e.R50("ngModel",n.editUserData.teamId),e.R7$(3),e.Y8G("ngForOf",n.teams),e.R7$(4),e.R50("ngModel",n.editUserData.role),e.R7$(10),e.Y8G("disabled",!t.valid)}}function F(a,l){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td")(8,"span",56),e.EFF(9),e.k0s()(),e.j41(10,"td"),e.EFF(11),e.k0s(),e.j41(12,"td")(13,"span",57),e.EFF(14),e.k0s()(),e.j41(15,"td")(16,"div",58)(17,"button",59),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.editUser(s))}),e.nrm(18,"i",60),e.k0s(),e.j41(19,"button",61),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.deleteUser(s.id))}),e.nrm(20,"i",62),e.k0s()()()()}if(2&a){const t=l.$implicit,n=e.XpG();e.R7$(2),e.JRh(t.id),e.R7$(2),e.Lme("",t.firstName," ",t.lastName,""),e.R7$(2),e.JRh(t.email),e.R7$(3),e.JRh(t.role),e.R7$(2),e.JRh(n.getTeamName(t.teamId)),e.R7$(2),e.AVh("bg-success",t.isActive)("bg-danger",!t.isActive),e.R7$(),e.SpI(" ",t.isActive?"Active":"Inactive"," ")}}function M(a,l){1&a&&(e.j41(0,"div",63),e.nrm(1,"i",64),e.j41(2,"h5",65),e.EFF(3,"No users found"),e.k0s(),e.j41(4,"p"),e.EFF(5,"Add your first user to get started!"),e.k0s()())}let j=(()=>{class a{constructor(t,n,s,r){this.usersService=t,this.teamsService=n,this.toastr=s,this.authService=r,this.users=[],this.teams=[],this.showCreateForm=!1,this.showEditForm=!1,this.editingUser=null,this.newUser={firstName:"",lastName:"",email:"",password:"",employeeId:"",teamId:"",role:""},this.editUserData={firstName:"",lastName:"",email:"",employeeId:"",teamId:"",role:""}}ngOnInit(){this.loadUsers(),this.loadTeams(),this.testBackendConnection()}testBackendConnection(){console.log("Testing backend connection..."),this.usersService.getUsers().subscribe({next:t=>{console.log("Backend connection successful:",t)},error:t=>{console.error("Backend connection failed:",t),this.toastr.error("Cannot connect to backend server")}})}loadUsers(){this.usersService.getUsers().subscribe({next:t=>{this.users=Array.isArray(t)?t:t.data||[],console.log("Loaded users:",this.users)},error:t=>{console.error("Error loading users:",t),this.toastr.error("Failed to load users")}})}loadTeams(){this.teamsService.getTeams().subscribe({next:t=>{console.log("Teams response:",t),this.teams=Array.isArray(t)?t:t.data||[],console.log("Teams loaded:",this.teams)},error:t=>{console.error("Error loading teams:",t)}})}createUser(){if(!(this.newUser.firstName&&this.newUser.lastName&&this.newUser.email&&this.newUser.password))return void this.toastr.error("Please fill in all required fields");if(!this.newUser.role)return void this.toastr.error("Please select a role for the user");console.log("Sending user data:",this.newUser);const t={...this.newUser,teamId:this.newUser.teamId?parseInt(this.newUser.teamId):void 0,isActive:!0,emailVerified:!0};console.log("Processed user data:",t),console.log("Current auth token:",this.authService.getToken()),this.usersService.createUser(t).subscribe({next:n=>{console.log("Create user response:",n),this.toastr.success("User created successfully"),this.loadUsers(),this.cancelCreate()},error:n=>{console.error("Error creating user:",n),console.error("Error status:",n.status),console.error("Error statusText:",n.statusText),console.error("Error response:",n.error),console.error("Error message:",n.message),this.toastr.error("Failed to create user")}})}editUser(t){this.editingUser=t,this.editUserData={firstName:t.firstName,lastName:t.lastName,email:t.email,employeeId:t.employeeId||"",teamId:t.teamId||"",role:t.role},this.showEditForm=!0,this.showCreateForm=!1}updateUser(){if(!(this.editUserData.firstName&&this.editUserData.lastName&&this.editUserData.email&&this.editUserData.role))return void this.toastr.error("Please fill in all required fields");const t={...this.editUserData,teamId:this.editUserData.teamId?parseInt(this.editUserData.teamId):void 0};this.usersService.updateUser(this.editingUser.id,t).subscribe({next:n=>{this.toastr.success("User updated successfully"),this.loadUsers(),this.cancelEdit()},error:n=>{console.error("Error updating user:",n),this.toastr.error("Failed to update user")}})}cancelEdit(){this.showEditForm=!1,this.editingUser=null,this.editUserData={firstName:"",lastName:"",email:"",employeeId:"",teamId:"",role:""}}deleteUser(t){console.log("Attempting to delete user with ID:",t),console.log("Current user:",this.authService.getCurrentUser()),console.log("Is admin:",this.authService.isAdmin()),confirm("Are you sure you want to delete this user?")&&this.usersService.deleteUser(t).subscribe({next:n=>{console.log("Delete response:",n),this.toastr.success("User deleted successfully"),this.loadUsers()},error:n=>{console.error("Error deleting user:",n),console.error("Error response:",n.error),this.toastr.error("Failed to delete user")}})}getTeamName(t){const n=this.teams.find(s=>s.id===t);return n?n.name:"N/A"}cancelCreate(){this.showCreateForm=!1,this.newUser={firstName:"",lastName:"",email:"",password:"",employeeId:"",teamId:"",role:""}}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(c.g),e.rXU(_.O),e.rXU(g.tw),e.rXU(u.u))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-user-management"]],standalone:!0,features:[e.aNF],decls:39,vars:4,consts:[["userForm","ngForm"],["editForm","ngForm"],[1,"container-fluid"],[1,"row","mb-4"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],["class","row mb-4",4,"ngIf"],[1,"row"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["class","text-center text-muted py-5",4,"ngIf"],[3,"ngSubmit"],[1,"col-md-6","mb-3"],["for","firstName",1,"form-label"],["type","text","id","firstName","name","firstName","required","","minlength","2",1,"form-control",3,"ngModelChange","ngModel"],["for","lastName",1,"form-label"],["type","text","id","lastName","name","lastName","required","","minlength","2",1,"form-control",3,"ngModelChange","ngModel"],["for","email",1,"form-label"],["type","email","id","email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","employeeId",1,"form-label"],["type","text","id","employeeId","name","employeeId",1,"form-control",3,"ngModelChange","ngModel"],["for","password",1,"form-label"],["type","password","id","password","name","password","required","","minlength","8",1,"form-control",3,"ngModelChange","ngModel"],["for","teamId",1,"form-label"],["id","teamId","name","teamId",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"form-label"],["name","role","required","",1,"form-select",3,"ngModelChange","ngModel"],["value","Admin"],["value","TeamLead"],["value","Employee"],[1,"d-flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"value"],["for","editFirstName",1,"form-label"],["type","text","id","editFirstName","name","editFirstName","required","","minlength","2",1,"form-control",3,"ngModelChange","ngModel"],["for","editLastName",1,"form-label"],["type","text","id","editLastName","name","editLastName","required","","minlength","2",1,"form-control",3,"ngModelChange","ngModel"],["for","editEmail",1,"form-label"],["type","email","id","editEmail","name","editEmail","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","editEmployeeId",1,"form-label"],["type","text","id","editEmployeeId","name","editEmployeeId",1,"form-control",3,"ngModelChange","ngModel"],["for","editTeamId",1,"form-label"],["id","editTeamId","name","editTeamId",1,"form-select",3,"ngModelChange","ngModel"],["for","editRole",1,"form-label"],["name","editRole","required","",1,"form-select",3,"ngModelChange","ngModel"],[1,"badge","bg-primary"],[1,"badge"],[1,"btn-group"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"bi","bi-pencil"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],[1,"text-center","text-muted","py-5"],[1,"bi","bi-people","fs-1"],[1,"mt-3"]],template:function(n,s){1&n&&(e.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2"),e.EFF(5,"User Management"),e.k0s(),e.j41(6,"button",6),e.bIt("click",function(){return s.showCreateForm=!0}),e.nrm(7,"i",7),e.EFF(8,"Add User "),e.k0s()()()(),e.DNE(9,h,56,9,"div",8)(10,U,52,8,"div",8),e.j41(11,"div",9)(12,"div",4)(13,"div",10)(14,"div",11)(15,"h5",12),e.EFF(16,"All Users"),e.k0s()(),e.j41(17,"div",13)(18,"div",14)(19,"table",15)(20,"thead")(21,"tr")(22,"th"),e.EFF(23,"ID"),e.k0s(),e.j41(24,"th"),e.EFF(25,"Name"),e.k0s(),e.j41(26,"th"),e.EFF(27,"Email"),e.k0s(),e.j41(28,"th"),e.EFF(29,"Role"),e.k0s(),e.j41(30,"th"),e.EFF(31,"Team"),e.k0s(),e.j41(32,"th"),e.EFF(33,"Status"),e.k0s(),e.j41(34,"th"),e.EFF(35,"Actions"),e.k0s()()(),e.j41(36,"tbody"),e.DNE(37,F,21,11,"tr",16),e.k0s()()(),e.DNE(38,M,6,0,"div",17),e.k0s()()()()()),2&n&&(e.R7$(9),e.Y8G("ngIf",s.showCreateForm),e.R7$(),e.Y8G("ngIf",s.showEditForm),e.R7$(27),e.Y8G("ngForOf",s.users),e.R7$(),e.Y8G("ngIf",0===s.users.length))},dependencies:[d.MD,d.Sq,d.bT,o.YN,o.qT,o.xH,o.y7,o.me,o.wz,o.BC,o.cb,o.YS,o.xh,o.vS,o.cV],encapsulation:2})}}return a})()}}]);